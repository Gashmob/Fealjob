{% extends 'page.html.twig' %}
{% block title %}Offres d'emploi{% endblock %}
{% block body %}
    <div style="margin-top: 20px  !important; margin-bottom: 40px;">
        <div style="margin-bottom: 20px;" class="ui right action left icon fluid input">
            <i class="search icon"></i>
            <input id="searchInput" type="text" placeholder="Rechercher">
            <div class="ui basic floating dropdown button">
                <div class="text">Tous les résultats</div>
                <i class="dropdown icon"></i>
                <div class="menu">
                    <div class="active item">Tous les résultats</div>
                    <div class="item">Offres d'emploi</div>
                    <div class="item">Candidats</div>
                    <div class="item">Auto-entrepreneurs</div>
                </div>
            </div>
            <div id="searchBtn" class="ui button">Rechercher</div>
        </div>
        <div class="ui grid stackable">
            <div class="five wide column">
                <div class="ui vertical menu">
                    <div class="item">
                        <div class="header">Products</div>
                        <div class="menu">
                            <a class="item">Enterprise</a>
                            <a class="item">Consumer</a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="header">CMS Solutions</div>
                        <div class="menu">
                            <a class="item">Rails</a>
                            <a class="item">Python</a>
                            <a class="item">PHP</a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="header">Hosting</div>
                        <div class="menu">
                            <a class="item">Shared</a>
                            <a class="item">Dedicated</a>
                        </div>
                    </div>
                    <div class="item">
                        <div class="header">Support</div>
                        <div class="menu">
                            <a class="item">E-mail Support</a>
                            <a class="item">FAQs</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="eleven wide column justified">
                <div id="offresList" class="ui two stackable cards">
                    <!--
                    <div class="card annonceCard">
                        <div class="content">
                            <a class="header">Pâtissier</a>
                            <div class="meta">
                                <span>
                                    <i class="icon map pin"></i>
                                    Aix-les-Bains,
                                </span>
                                <span>du 12/06 au 12/07</span>
                            </div>
                            <div class="description">
                                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Animi aperiam aut
                                    blanditiis delectus distinctio dolor dolorum ducimus molestiae, natus nostrum
                                    perspiciatis quaerat quam repellendus, sapiente vel veniam vitae. Iure, nihil.</p>
                            </div>
                            <div class="extra">
                                <div class="ui label">CDD</div>
                                <div class="ui label">CDI</div>
                                <div class="ui label"><i class="globe icon"></i>Anglais</div>
                                <a href="#"
                                   class="ui right floated green button">
                                    Voir l'annonce
                                    <i class="right chevron icon"></i>
                                </a>
                            </div>
                        </div>
                    </div>
                    -->
                    {% for i in 0..6 %}
                        <div class="item">
                            <div class="image">
                                <div class="ui placeholder">
                                    <div class="square image"></div>
                                </div>
                            </div>
                            <div class="content">
                                <div class="ui placeholder">
                                    <div class="header">
                                        <div class="very short line"></div>
                                        <div class="short line"></div>
                                    </div>
                                    <div class="paragraph">
                                        <div class="ui placeholder">
                                            <div class="line"></div>
                                            <div class="line"></div>
                                            <div class="line"></div>
                                            <div class="line"></div>
                                            <div class="line"></div>
                                            <div class="line"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
{% block javascripts %}
    <script type='text/javascript'>
        window.addEventListener("DOMContentLoaded", (event) => {
            makeRequest()
        });

        var httpRequest;
        var results;

        function makeRequest() {
            httpRequest = new XMLHttpRequest();

            if (!httpRequest) {
                alert('Abandon :( Impossible de créer une instance de XMLHTTP');
                return false;
            }
            httpRequest.onreadystatechange = displayOffres;
            httpRequest.open('POST', '/entreprise/get/offres_emploi');
            httpRequest.send();
        }

        function displayOffres() {
            if (httpRequest.readyState === XMLHttpRequest.DONE) {
                if (httpRequest.status === 200) {
                    //console.log(JSON.parse(httpRequest.responseText));
                    results = JSON.parse(httpRequest.responseText)
                    for (var i = 0; i < results.offres.length; i++) {
                        console.log(results.offres[i]);
                        var card = `
            <div class="card annonceCard">
                <div class="content">
                    <a class="header">` + results.offres[i].nom + `</a>
                    <div class="meta">
                        <span>
                            <i class="icon map pin"></i>
                            ` + results.offres[i].lieu.ville + `,
                        </span>
                        <br>
                        <span>du 12/06 au 12/07</span>
                    </div>
                    <div class="description">
                        <p>` + results.offres[i].description + `</p>
                    </div>
                    <div class="extra">
                        <div class="ui label">CDD</div>
                        <a href="{{ path('entreprise_show_cv', {'id': 1}) }}"
                           class="ui right floated green button">
                            Voir l'annonce
                            <i class="right chevron icon"></i>
                        </a>
                    </div>
                </div>
            </div>
            `;
                        offresList.innerHTML += card;
                    }
                } else {
                    alert('Il y a eu un problème avec la requête.');
                }
            }
        }

        function searchOffre(e) {
            e.preventDefault();
            var $link = $(e.currentTarget);
            $.ajax({
                url: '/entreprise/get/cvs' + $link.data('direction'),
                type: 'POST',
                success: OnSuccess,
                error: OnErrorCall,
            });
        }

        /*function retrieveOffres(response) {
            response.forEach(displayOffre());
        }*/

        const offresList = document.getElementById('offresList');

        function displayOffre(item, index) {
            var card = `
            <div class="card annonceCard">
                <div class="content">
                    <a class="header">` + item.nom + `</a>
                    <div class="meta">
                        <span>
                            <i class="icon map pin"></i>
                            Aix-les-Bains,
                        </span>
                        <span>du 12/06 au 12/07</span>
                    </div>
                    <div class="description">
                        <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit. Animi aperiam aut
                            blanditiis delectus distinctio dolor dolorum ducimus molestiae, natus nostrum
                            perspiciatis quaerat quam repellendus, sapiente vel veniam vitae. Iure, nihil.</p>
                    </div>
                    <div class="extra">
                        <div class="ui label">CDD</div>
                        <div class="ui label">CDI</div>
                        <div class="ui label"><i class="globe icon"></i>Anglais</div>
                        <a href="#"
                           class="ui right floated green button">
                            Voir l'annonce
                            <i class="right chevron icon"></i>
                        </a>
                    </div>
                </div>
            </div>
            `;
            offresList.innerHTML += card;
        }

        function onSuccess() {
            console.log('onSuccess');
        }

        function onErrorCall() {
            console.log('onErrorCall');
        }
    </script>
{% endblock %}